<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>কমেন্ট এবং সাবমিশন সিস্টেম</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla:wght@400;700&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
--primary:#2563eb; --primary-dark:#1e40af; --secondary:#10b981; --accent:#8b5cf6; --danger:#ef4444;
--warning:#f59e0b; --dark:#0f172a; --darker:#0a0e1a; --light:#f1f5f9; --text:#e2e8f0;
--text-muted:#94a3b8; --card-bg:rgba(30,41,59,0.7); --card-border:rgba(255,255,255,0.08);
--glass:rgba(15,23,42,0.6); --glass-border:rgba(255,255,255,0.1);
--gradient-primary:linear-gradient(135deg,#2563eb 0%,#10b981 100%);
--gradient-secondary:linear-gradient(135deg,#8b5cf6 0%,#ec4899 100%);
--shadow-sm:0 4px 6px rgba(0,0,0,0.1); --shadow-md:0 10px 15px -3px rgba(0,0,0,0.2);
--shadow-lg:0 20px 25px -5px rgba(0,0,0,0.3); --radius:12px; --transition:all 0.3s ease;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{background:var(--darker);color:var(--text);font-family:'Poppins','Tiro Bangla',system-ui,sans-serif;line-height:1.6;min-height:100vh;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none;}
body::-webkit-scrollbar{display:none;}
.bangla-font{font-family:'Tiro Bangla','Poppins',serif;}
.container{max-width:980px;margin:40px auto;padding:20px;}
.action-buttons{display:flex;justify-content:center;gap:12px;margin-bottom:20px;}
.form-button,.submissions-button,.comment-button,.reply-button,.admin-button{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:8px;border:none;background:var(--gradient-secondary);color:white;font-weight:600;font-size:0.85rem;cursor:pointer;transition:var(--transition);box-shadow:var(--shadow-sm);position:relative;overflow:hidden;}
.form-button:hover,.submissions-button:hover,.comment-button:hover,.reply-button:hover,.admin-button:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.form-button::before,.submissions-button::before,.comment-button::before,.reply-button::before,.admin-button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:0.5s;}
.form-button:hover::before,.submissions-button:hover::before,.comment-button:hover::before,.reply-button:hover::before,.admin-button:hover::before{left:100%;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000;backdrop-filter:blur(5px);}
.modal-content{background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;padding:25px;max-width:600px;width:90%;backdrop-filter:blur(12px);box-shadow:var(--shadow-lg);position:relative;overflow-y:auto;max-height:90vh;scroll-behavior:smooth;}
.modal-content::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:var(--gradient-primary);}
.modal-close{position:absolute;top:15px;right:15px;background:none;border:none;color:var(--text-muted);font-size:1.5rem;cursor:pointer;transition:var(--transition);}
.modal-close:hover{color:var(--danger);}
.modal-intro{margin-bottom:20px;text-align:center;}
.modal-intro h2{font-size:1.4rem;background:var(--gradient-primary);-webkit-background-clip:text;background-clip:text;color:transparent;margin-bottom:10px;}
.modal-intro p{color:var(--text-muted);font-size:0.9rem;line-height:1.6;}
.form-section{display:flex;flex-direction:column;gap:25px;}
.form-section label{font-weight:bold;font-size:0.95rem;color:var(--text);text-align:left;}
.form-section input,.form-section select,.form-section textarea{padding:12px 16px;border-radius:10px;border:1px solid var(--card-border);background:var(--glass);color:var(--text);outline:none;transition:var(--transition);backdrop-filter:blur(10px);font-size:0.9rem;}
.form-section input:focus,.form-section select:focus,.form-section textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,0.2);}
.form-section textarea{resize:vertical;min-height:120px;}
.submit-button{width:100%;padding:12px;border-radius:10px;border:none;background:var(--gradient-primary);color:white;font-weight:600;font-size:0.95rem;cursor:pointer;transition:var(--transition);box-shadow:0 4px 10px rgba(37,99,235,0.3);display:flex;align-items:center;justify-content:center;gap:8px;}
.submit-button:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(37,99,235,0.4);}
.submit-button.loading .spinner{display:inline-block;}
.spinner{display:none;width:16px;height:16px;border:2px solid white;border-top:2px solid transparent;border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.success-message{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--secondary);color:white;padding:20px 40px;border-radius:10px;z-index:2000;font-size:1rem;box-shadow:var(--shadow-md);text-align:center;max-width:80%;}
.notification{position:fixed;bottom:30px;right:30px;padding:15px 22px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:10px;box-shadow:var(--shadow-lg);z-index:1000;opacity:0;transform:translateY(20px);transition:opacity 0.3s,transform 0.3s;backdrop-filter:blur(15px);display:flex;align-items:center;gap:10px;max-width:350px;font-size:0.9rem;}
.notification.show{opacity:1;transform:translateY(0);}
.notification.success{border-left:4px solid var(--secondary);}
.notification.error{border-left:4px solid var(--danger);}
.submissions-list,.reply-list,.sub-buttons{display:flex;flex-direction:column;gap:15px;max-height:60vh;overflow-y:auto;scroll-behavior:smooth;}
.submission-item{background:var(--glass);border:1px solid var(--glass-border);border-radius:10px;padding:15px;box-shadow:var(--shadow-sm);transition:var(--transition);}
.submission-item:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.submission-name{font-weight:600;font-size:1rem;color:var(--primary);}
.submission-batch{font-size:0.85rem;color:var(--text-muted);}
.submission-message{margin-top:10px;font-size:0.9rem;}
.submission-reply{margin-top:10px;font-size:0.9rem;border-top:1px solid var(--card-border);padding-top:10px;color:var(--secondary);}
.submission-time{font-size:0.75rem;color:var(--text-muted);margin-top:5px;text-align:right;}
.reply-btn{padding:8px 16px;border-radius:8px;background:var(--gradient-secondary);color:white;border:none;cursor:pointer;margin-top:10px;transition:var(--transition);box-shadow:var(--shadow-sm);}
.reply-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.warning-message{background:var(--warning);color:white;padding:15px;border-radius:10px;margin-bottom:20px;text-align:center;font-size:0.9rem;}
@media(max-width:768px){.container{padding:15px;margin:20px;}.modal-content{padding:20px;max-height:90vh;}.action-buttons{flex-direction:column;gap:10px;}.form-button,.submissions-button,.comment-button,.reply-button,.admin-button{width:100%;justify-content:center;}}
@media(max-width:480px){.modal-intro h2{font-size:1.2rem;}.form-section label,.form-section input,.form-section select,.form-section textarea,.submit-button{font-size:0.85rem;}.submission-item{padding:12px;}.submission-name,.submission-message{font-size:0.85rem;}.submission-batch,.submission-time{font-size:0.75rem;}}
</style>
</head>
<body>
<div class="container">
  <div class="action-buttons">
    <button class="comment-button" id="comment-button"><i class="fas fa-comment-dots"></i> <span class="bangla-font">কমেন্ট</span></button>
    <button class="submissions-button" id="submissions-button"><i class="fas fa-list-alt"></i> <span class="bangla-font">সাবমিশন দেখুন</span></button>
  </div>
</div>
<!-- Name Set Modal -->
<div class="modal" id="nameModal">
  <div class="modal-content">
    <button class="modal-close" onclick="hideNameModal()">×</button>
    <div class="modal-intro">
      <h2 class="bangla-font">নাম সেট করুন</h2>
      <p class="bangla-font">আপনার নাম লিখুন। এটি সেভ হয়ে যাবে এবং পরবর্তীতে কমেন্ট ও রিপ্লাই দেখার জন্য ব্যবহৃত হবে।</p>
      <div class="warning-message bangla-font">
        দয়া করে আপনার পূর্ণ নাম ব্যবহার করুন, যাতে অন্য কারো সাথে নামের কোনো মিল না হয়। একটি স্বতন্ত্র এবং ব্যতিক্রমী নাম নির্বাচন করুন, যেন আপনার মতামত এবং উত্তর সঠিকভাবে সনাক্ত করা যায়।
      </div>
    </div>
    <div class="form-section">
      <form id="nameForm" onsubmit="saveName(event)">
        <label class="bangla-font" for="userName">নাম</label>
        <input type="text" id="userName" placeholder="আপনার পূর্ণ নাম লিখুন" required class="bangla-font">
        <button type="submit" class="submit-button bangla-font">সেভ করুন</button>
      </form>
    </div>
  </div>
</div>
<!-- Comment Options Modal -->
<div class="modal" id="commentOptionsModal">
  <div class="modal-content">
    <button class="modal-close" onclick="hideCommentOptions()">×</button>
    <div class="modal-intro">
      <h2 class="bangla-font">কমেন্ট অপশন</h2>
      <p class="bangla-font">নিচের অপশন থেকে নির্বাচন করুন।</p>
    </div>
    <div class="sub-buttons">
      <button class="form-button" onclick="showForm()"><i class="fas fa-edit"></i> <span class="bangla-font">কমেন্ট করুন</span></button>
      <button class="reply-button" onclick="showReply()"><i class="fas fa-reply"></i> <span class="bangla-font">রিপ্লাই দেখুন</span></button>
    </div>
  </div>
</div>
<!-- Form Modal -->
<div class="modal" id="formModal">
  <div class="modal-content">
    <button class="modal-close" onclick="hideForm()">×</button>
    <div class="modal-intro">
      <h2 class="bangla-font">আপনার মতামত আমাদের কাছে মূল্যবান</h2>
      <p class="bangla-font">প্রিয় শিক্ষার্থী, আমাদের শিক্ষামূলক ওয়েবসাইট আপনাদের শিক্ষা ও জ্ঞানার্জনের পথকে আরও সহজ ও ফলপ্রসূ করতে প্রতিশ্রুতিবদ্ধ। নিচের ফর্মটি পূরণ করুন।</p>
    </div>
    <div class="form-section">
      <form id="myForm" onsubmit="submitForm(event)">
        <label class="bangla-font" for="name">নাম</label>
        <input type="text" name="name" id="name" placeholder="আপনার নাম" required class="bangla-font" readonly>
        <label class="bangla-font" for="batch">ব্যাচ নাম</label>
        <select name="batch" id="batch" required class="bangla-font">
          <option value="" disabled selected class="bangla-font">ব্যাচ নির্বাচন করুন</option>
          <option value="Alim-25" class="bangla-font">আলিম-২৫</option>
          <option value="Dakhil-26" class="bangla-font">দাখিল-২৬</option>
          <option value="Alim-26" class="bangla-font">আলিম-২৬</option>
        </select>
        <label class="bangla-font" for="message">মতামত/পরামর্শ/অভিযোগ</label>
        <textarea name="message" id="message" placeholder="আপনার মতামত লিখুন" required class="bangla-font"></textarea>
        <button type="submit" class="submit-button bangla-font" id="submitBtn">জমা দিন <span class="spinner"></span></button>
      </form>
    </div>
  </div>
</div>
<!-- Reply View Modal -->
<div class="modal" id="replyModal">
  <div class="modal-content">
    <button class="modal-close" onclick="hideReply()">×</button>
    <div class="modal-intro">
      <h2 class="bangla-font">রিপ্লাই দেখুন</h2>
      <p class="bangla-font">আপনার মেসেজের উত্তর দেখুন।</p>
    </div>
    <div id="reply-list" class="reply-list"></div>
  </div>
</div>
<!-- Submissions Modal -->
<div class="modal" id="submissionsModal">
  <div class="modal-content">
    <button class="modal-close" onclick="hideSubmissions()">×</button>
    <div class="modal-intro">
      <h2 class="bangla-font">সাবমিশন তালিকা</h2>
      <p class="bangla-font">এখানে সকল সাবমিশন দেখুন।</p>
    </div>
    <div id="submissions-list" class="submissions-list"></div>
  </div>
</div>
<!-- Admin Reply Modal -->
<div class="modal" id="adminModal">
  <div class="modal-content">
    <button class="modal-close" onclick="hideAdmin()">×</button>
    <div class="modal-intro">
      <h2 class="bangla-font">অ্যাডমিন উত্তর দিন</h2>
      <p class="bangla-font">এখানে সাবমিশনের উত্তর দিন।</p>
    </div>
    <div class="form-section">
      <form id="adminForm" onsubmit="submitAdminReply(event)">
        <label class="bangla-font" for="submissionId">সাবমিশন আইডি (যেটির উত্তর দিবেন)</label>
        <input type="text" name="submissionId" id="submissionId" placeholder="সাবমিশন আইডি" required class="bangla-font">
        <label class="bangla-font" for="reply">উত্তর</label>
        <textarea name="reply" id="reply" placeholder="আপনার উত্তর লিখুন" required class="bangla-font"></textarea>
        <button type="submit" class="submit-button bangla-font">উত্তর জমা দিন</button>
      </form>
    </div>
  </div>
</div>
<div class="success-message" id="successMessage">ফর্ম সফলভাবে জমা হয়েছে!</div>
<div id="notification" class="notification"></div>
<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyhF1MbIgfLLiox5IlVxztrUZCN9sxEBtj5-4IfypATarCnm7tbMpr-9Omb0DY8eP9hzg/exec"; // আপনার working URL

function $(sel){ return document.querySelector(sel); }

function showNotification(message, isError=false){
  const notification = $('#notification');
  notification.innerHTML = `<i class="${isError?'fas fa-exclamation-circle':'fas fa-check-circle'}"></i> <span class="bangla-font">${message}</span>`;
  notification.className=`notification ${isError?'error':'success'}`;
  notification.classList.add('show');
  setTimeout(()=>notification.classList.remove('show'),3000);
}

let storedName = localStorage.getItem('userName') || '';

function showNameModal(){ $('#nameModal').style.display='flex'; }
function hideNameModal(){ $('#nameModal').style.display='none'; }

function saveName(event){
  event.preventDefault();
  const name = $('#userName').value.trim();
  if (name) {
    localStorage.setItem('userName', name);
    storedName = name;
    hideNameModal();
    showCommentOptions();
  } else {
    showNotification("নাম লিখুন!", true);
  }
}

function showCommentOptions(){ $('#commentOptionsModal').style.display='flex'; }
function hideCommentOptions(){ $('#commentOptionsModal').style.display='none'; }

function handleCommentClick() {
  if (!storedName) {
    showNameModal();
  } else {
    showCommentOptions();
  }
}

function showForm(){ 
  hideCommentOptions();
  $('#formModal').style.display='flex'; 
  $('#myForm').reset(); 
  $('#name').value = storedName;
}

function hideForm(){ $('#formModal').style.display='none'; }

function showReply(){ 
  hideCommentOptions();
  $('#replyModal').style.display='flex'; 
  loadReplies();
}

function hideReply(){ $('#replyModal').style.display='none'; }

function showSubmissions(){ 
  $('#submissionsModal').style.display='flex'; 
  loadSubmissions(); 
}

function hideSubmissions(){ $('#submissionsModal').style.display='none'; }

function showAdmin(){ $('#adminModal').style.display='flex'; $('#adminForm').reset(); }
function hideAdmin(){ $('#adminModal').style.display='none'; }
function openAdminWithId(id){ showAdmin(); $('#submissionId').value = id; }

function submitForm(event){
  event.preventDefault();
  const submitBtn = $('#submitBtn');
  submitBtn.classList.add('loading');
  submitBtn.disabled = true;
  const form = $('#myForm');
  const data = {
    name: form.name.value.trim(),
    batch: form.batch.value,
    message: form.message.value.trim()
  };

  fetch(WEB_APP_URL,{
    method:'POST',
    body:JSON.stringify(data)
  })
  .then(res=>res.text())
  .then(txt=>{
    submitBtn.classList.remove('loading');
    submitBtn.disabled = false;
    if(txt.startsWith("Success")){
      form.reset(); hideForm(); showSuccessMessage();
    }else{
      showNotification("ডেটা জমা হয়নি! আবার চেষ্টা করুন।", true);
    }
  })
  .catch(()=>{
    submitBtn.classList.remove('loading');
    submitBtn.disabled = false;
    showNotification("ডেটা জমা হয়নি! আবার চেষ্টা করুন।", true);
  });
}

function submitAdminReply(event){
  event.preventDefault();
  const form = $('#adminForm');
  const data = {
    submissionId: form.submissionId.value.trim(),
    reply: form.reply.value.trim()
  };

  fetch(WEB_APP_URL,{
    method:'POST',
    body:JSON.stringify(data)
  })
  .then(res=>res.text())
  .then(txt=>{
    if(txt.startsWith("Success")){
      form.reset(); hideAdmin(); showSuccessMessage();
    }else{
      showNotification("উত্তর জমা হয়নি! আবার চেষ্টা করুন।", true);
    }
  })
  .catch(()=>showNotification("উত্তর জমা হয়নি! আবার চেষ্টা করুন।", true));
}

function showSuccessMessage(){
  const successMessage = $('#successMessage');
  successMessage.style.display='block';
  setTimeout(()=>successMessage.style.display='none',3000);
}

function loadSubmissions() {
  fetch(WEB_APP_URL + '?action=getSubmissions')
    .then(res => res.json())
    .then(data => {
      const list = $('#submissions-list');
      list.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'submission-item';
        div.innerHTML = `
          <div class="submission-name bangla-font">${item.name}</div>
          <div class="submission-batch bangla-font">ব্যাচ: ${item.batch}</div>
          <div class="submission-message bangla-font">${item.message}</div>
          ${item.reply ? `<div class="submission-reply bangla-font">উত্তর: ${item.reply}</div>` : ''}
          <div class="submission-time bangla-font">${item.time}</div>
        `;
        if (!item.reply) {
          const btn = document.createElement('button');
          btn.className = 'reply-btn bangla-font';
          btn.innerText = 'উত্তর দিন';
          btn.onclick = () => openAdminWithId(item.time);
          div.appendChild(btn);
        }
        list.appendChild(div);
      });
    })
    .catch(() => showNotification("সাবমিশন লোড হয়নি! আবার চেষ্টা করুন।", true));
}

function loadReplies() {
  const name = storedName.toLowerCase();
  if (!name) return showNotification("নাম সেট করুন!", true);
  fetch(WEB_APP_URL + '?action=getSubmissions')
    .then(res => res.json())
    .then(data => {
      const list = $('#reply-list');
      list.innerHTML = '';
      const filtered = data.filter(item => item.name.toLowerCase() === name && item.reply);
      if (filtered.length === 0) {
        list.innerHTML = '<p class="bangla-font" style="text-align:center;color:var(--text-muted);">কোনো উত্তর পাওয়া যায়নি।</p>';
      } else {
        filtered.forEach(item => {
          const div = document.createElement('div');
          div.className = 'submission-item';
          div.innerHTML = `
            <div class="submission-message bangla-font">প্রশ্ন: ${item.message}</div>
            <div class="submission-reply bangla-font">উত্তর: ${item.reply}</div>
            <div class="submission-time bangla-font">${item.time}</div>
          `;
          list.appendChild(div);
        });
      }
    })
    .catch(() => showNotification("রিপ্লাই লোড হয়নি! আবার চেষ্টা করুন।", true));
}

$('#comment-button').addEventListener('click', handleCommentClick);
$('#submissions-button').addEventListener('click',showSubmissions);
window.addEventListener('click',(e)=>{ 
  if(e.target==$('#nameModal')) hideNameModal(); 
  if(e.target==$('#commentOptionsModal')) hideCommentOptions(); 
  if(e.target==$('#formModal')) hideForm(); 
  if(e.target==$('#replyModal')) hideReply(); 
  if(e.target==$('#submissionsModal')) hideSubmissions(); 
  if(e.target==$('#adminModal')) hideAdmin(); 
});
</script>
</body>
</html>
